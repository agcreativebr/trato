"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/cards/route";
exports.ids = ["app/api/cards/route"];
exports.modules = {

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcards%2Froute&page=%2Fapi%2Fcards%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcards%2Froute.ts&appDir=C%3A%5Cprojetos%5Ctrato%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5Cprojetos%5Ctrato&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcards%2Froute&page=%2Fapi%2Fcards%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcards%2Froute.ts&appDir=C%3A%5Cprojetos%5Ctrato%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5Cprojetos%5Ctrato&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_projetos_trato_app_api_cards_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/cards/route.ts */ \"(rsc)/./app/api/cards/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/cards/route\",\n        pathname: \"/api/cards\",\n        filename: \"route\",\n        bundlePath: \"app/api/cards/route\"\n    },\n    resolvedPagePath: \"C:\\\\projetos\\\\trato\\\\app\\\\api\\\\cards\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_projetos_trato_app_api_cards_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/cards/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZjYXJkcyUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGY2FyZHMlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZjYXJkcyUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDcHJvamV0b3MlNUN0cmF0byU1Q2FwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9QyUzQSU1Q3Byb2pldG9zJTVDdHJhdG8maXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQ0Y7QUFDM0U7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxpRUFBaUU7QUFDekU7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUN1SDs7QUFFdkgiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9rYW5iYW5wcm8vP2ZkMTYiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQXBwUm91dGVSb3V0ZU1vZHVsZSB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2Z1dHVyZS9yb3V0ZS1raW5kXCI7XG5pbXBvcnQgeyBwYXRjaEZldGNoIGFzIF9wYXRjaEZldGNoIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvbGliL3BhdGNoLWZldGNoXCI7XG5pbXBvcnQgKiBhcyB1c2VybGFuZCBmcm9tIFwiQzpcXFxccHJvamV0b3NcXFxcdHJhdG9cXFxcYXBwXFxcXGFwaVxcXFxjYXJkc1xcXFxyb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvY2FyZHMvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9jYXJkc1wiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvY2FyZHMvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCJDOlxcXFxwcm9qZXRvc1xcXFx0cmF0b1xcXFxhcHBcXFxcYXBpXFxcXGNhcmRzXFxcXHJvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuY29uc3Qgb3JpZ2luYWxQYXRobmFtZSA9IFwiL2FwaS9jYXJkcy9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcards%2Froute&page=%2Fapi%2Fcards%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcards%2Froute.ts&appDir=C%3A%5Cprojetos%5Ctrato%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5Cprojetos%5Ctrato&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/cards/route.ts":
/*!********************************!*\
  !*** ./app/api/cards/route.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   PATCH: () => (/* binding */ PATCH),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_supabase_server__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/supabase-server */ \"(rsc)/./lib/supabase-server.ts\");\n/* harmony import */ var _lib_automation_engine__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/automation/engine */ \"(rsc)/./lib/automation/engine.ts\");\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! next/headers */ \"(rsc)/./node_modules/next/dist/api/headers.js\");\n\n\n\n\nasync function POST(req) {\n    const supabase = (0,_lib_supabase_server__WEBPACK_IMPORTED_MODULE_1__.getSupabaseServerClient)();\n    const body = await req.json();\n    const { title, board_id, list_id, position, description, due_date } = body ?? {};\n    if (!title || !board_id || !list_id || typeof position !== \"number\") return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n        error: \"title, board_id, list_id e position s\\xe3o obrigat\\xf3rios\"\n    }, {\n        status: 422\n    });\n    // identifica ator\n    let actor_id = null;\n    try {\n        const hdr = req.headers.get(\"authorization\") ?? req.headers.get(\"x-sb-access-token\") ?? \"\";\n        const tokenHeader = hdr?.toLowerCase().startsWith(\"bearer \") ? hdr.slice(7) : hdr || undefined;\n        const token = tokenHeader ?? (0,next_headers__WEBPACK_IMPORTED_MODULE_3__.cookies)().get(\"sb-access-token\")?.value;\n        if (token) {\n            const { data: authUser } = await supabase.auth.getUser(token);\n            actor_id = authUser?.user?.id ?? null;\n        }\n    } catch  {}\n    const insert = {\n        title,\n        board_id,\n        list_id,\n        position,\n        description: description ?? null,\n        due_date: due_date ?? null\n    };\n    const { data, error } = await supabase.from(\"cards\").insert(insert).select(\"*\").single();\n    if (error) return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n        error: error.message\n    }, {\n        status: 400\n    });\n    // history\n    await supabase.from(\"card_history\").insert({\n        card_id: data.id,\n        action: \"created\",\n        actor_id,\n        payload: insert\n    });\n    // automations: card.created\n    try {\n        await (0,_lib_automation_engine__WEBPACK_IMPORTED_MODULE_2__.dispatchAutomationForEvent)({\n            type: \"card.created\",\n            board_id: data.board_id,\n            card_id: data.id,\n            list_id: data.list_id\n        });\n    } catch  {}\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n        data\n    });\n}\nasync function PATCH(req) {\n    const supabase = (0,_lib_supabase_server__WEBPACK_IMPORTED_MODULE_1__.getSupabaseServerClient)();\n    const body = await req.json();\n    const { id, ...rest } = body ?? {};\n    if (!id) return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n        error: \"id \\xe9 obrigat\\xf3rio\"\n    }, {\n        status: 422\n    });\n    // identifica ator\n    let actor_id = null;\n    try {\n        const hdr = req.headers.get(\"authorization\") ?? req.headers.get(\"x-sb-access-token\") ?? \"\";\n        const tokenHeader = hdr?.toLowerCase().startsWith(\"bearer \") ? hdr.slice(7) : hdr || undefined;\n        const token = tokenHeader ?? (0,next_headers__WEBPACK_IMPORTED_MODULE_3__.cookies)().get(\"sb-access-token\")?.value;\n        if (token) {\n            const { data: authUser } = await supabase.auth.getUser(token);\n            actor_id = authUser?.user?.id ?? null;\n        }\n    } catch  {}\n    // estado anterior\n    const { data: before } = await supabase.from(\"cards\").select(\"*\").eq(\"id\", id).single();\n    const { data, error } = await supabase.from(\"cards\").update(rest).eq(\"id\", id).select(\"*\").single();\n    if (error) return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n        error: error.message\n    }, {\n        status: 400\n    });\n    await supabase.from(\"card_history\").insert({\n        card_id: data.id,\n        action: \"updated\",\n        actor_id,\n        payload: {\n            before,\n            after: rest\n        }\n    });\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n        data\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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TUMsY0FBY0gsS0FBS0ksY0FBY0MsV0FBVyxhQUFhTCxJQUFJTSxLQUFLLENBQUMsS0FBS04sT0FBT087UUFDckYsTUFBTUMsUUFBUUwsZUFBZWxCLHFEQUFPQSxHQUFHaUIsR0FBRyxDQUFDLG9CQUFvQk87UUFDL0QsSUFBSUQsT0FBTztZQUNULE1BQU0sRUFBRUUsTUFBTUMsUUFBUSxFQUFFLEdBQUcsTUFBTXZCLFNBQVN3QixJQUFJLENBQUNDLE9BQU8sQ0FBQ0w7WUFDdkRULFdBQVdZLFVBQVVHLE1BQU1DLE1BQU07UUFDbkM7SUFDRixFQUFFLE9BQU0sQ0FBQztJQUNULGtCQUFrQjtJQUNsQixNQUFNLEVBQUVMLE1BQU1pQixNQUFNLEVBQUUsR0FBRyxNQUFNdkMsU0FBUzZCLElBQUksQ0FBQyxTQUFTQyxNQUFNLENBQUMsS0FBS1UsRUFBRSxDQUFDLE1BQU1iLElBQUlJLE1BQU07SUFDckYsTUFBTSxFQUFFVCxJQUFJLEVBQUViLEtBQUssRUFBRSxHQUFHLE1BQU1ULFNBQzNCNkIsSUFBSSxDQUFDLFNBQ0xZLE1BQU0sQ0FBQ0gsTUFDUEUsRUFBRSxDQUFDLE1BQU1iLElBQ1RHLE1BQU0sQ0FBQyxLQUNQQyxNQUFNO0lBQ1QsSUFBSXRCLE9BQ0YsT0FBT2YscURBQVlBLENBQUNRLElBQUksQ0FBQztRQUFFTyxPQUFPQSxNQUFNdUIsT0FBTztJQUFDLEdBQUc7UUFBRXRCLFFBQVE7SUFBSTtJQUNuRSxNQUFNVixTQUFTNkIsSUFBSSxDQUFDLGdCQUFnQkQsTUFBTSxDQUFDO1FBQ3pDSyxTQUFTWCxLQUFLSyxFQUFFO1FBQ2hCTyxRQUFRO1FBQ1J2QjtRQUNBd0IsU0FBUztZQUFFSTtZQUFRRyxPQUFPSjtRQUFLO0lBQ2pDO0lBQ0EsT0FBTzVDLHFEQUFZQSxDQUFDUSxJQUFJLENBQUM7UUFBRW9CO0lBQUs7QUFDbEMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9rYW5iYW5wcm8vLi9hcHAvYXBpL2NhcmRzL3JvdXRlLnRzP2E3ZjIiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gXCJuZXh0L3NlcnZlclwiO1xyXG5pbXBvcnQgeyBnZXRTdXBhYmFzZVNlcnZlckNsaWVudCB9IGZyb20gXCJAL2xpYi9zdXBhYmFzZS1zZXJ2ZXJcIjtcclxuaW1wb3J0IHsgZGlzcGF0Y2hBdXRvbWF0aW9uRm9yRXZlbnQgfSBmcm9tIFwiQC9saWIvYXV0b21hdGlvbi9lbmdpbmVcIjtcclxuaW1wb3J0IHsgY29va2llcyB9IGZyb20gXCJuZXh0L2hlYWRlcnNcIjtcclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcTogTmV4dFJlcXVlc3QpIHtcclxuICBjb25zdCBzdXBhYmFzZSA9IGdldFN1cGFiYXNlU2VydmVyQ2xpZW50KCk7XHJcbiAgY29uc3QgYm9keSA9IGF3YWl0IHJlcS5qc29uKCk7XHJcbiAgY29uc3QgeyB0aXRsZSwgYm9hcmRfaWQsIGxpc3RfaWQsIHBvc2l0aW9uLCBkZXNjcmlwdGlvbiwgZHVlX2RhdGUgfSA9XHJcbiAgICBib2R5ID8/IHt9O1xyXG4gIGlmICghdGl0bGUgfHwgIWJvYXJkX2lkIHx8ICFsaXN0X2lkIHx8IHR5cGVvZiBwb3NpdGlvbiAhPT0gXCJudW1iZXJcIilcclxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcclxuICAgICAgeyBlcnJvcjogXCJ0aXRsZSwgYm9hcmRfaWQsIGxpc3RfaWQgZSBwb3NpdGlvbiBzw6NvIG9icmlnYXTDs3Jpb3NcIiB9LFxyXG4gICAgICB7IHN0YXR1czogNDIyIH1cclxuICAgICk7XHJcbiAgLy8gaWRlbnRpZmljYSBhdG9yXHJcbiAgbGV0IGFjdG9yX2lkOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcclxuICB0cnkge1xyXG4gICAgY29uc3QgaGRyID0gcmVxLmhlYWRlcnMuZ2V0KFwiYXV0aG9yaXphdGlvblwiKSA/PyByZXEuaGVhZGVycy5nZXQoXCJ4LXNiLWFjY2Vzcy10b2tlblwiKSA/PyBcIlwiO1xyXG4gICAgY29uc3QgdG9rZW5IZWFkZXIgPSBoZHI/LnRvTG93ZXJDYXNlKCkuc3RhcnRzV2l0aChcImJlYXJlciBcIikgPyBoZHIuc2xpY2UoNykgOiBoZHIgfHwgdW5kZWZpbmVkO1xyXG4gICAgY29uc3QgdG9rZW4gPSB0b2tlbkhlYWRlciA/PyBjb29raWVzKCkuZ2V0KFwic2ItYWNjZXNzLXRva2VuXCIpPy52YWx1ZTtcclxuICAgIGlmICh0b2tlbikge1xyXG4gICAgICBjb25zdCB7IGRhdGE6IGF1dGhVc2VyIH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIodG9rZW4pO1xyXG4gICAgICBhY3Rvcl9pZCA9IGF1dGhVc2VyPy51c2VyPy5pZCA/PyBudWxsO1xyXG4gICAgfVxyXG4gIH0gY2F0Y2gge31cclxuICBjb25zdCBpbnNlcnQgPSB7XHJcbiAgICB0aXRsZSxcclxuICAgIGJvYXJkX2lkLFxyXG4gICAgbGlzdF9pZCxcclxuICAgIHBvc2l0aW9uLFxyXG4gICAgZGVzY3JpcHRpb246IGRlc2NyaXB0aW9uID8/IG51bGwsXHJcbiAgICBkdWVfZGF0ZTogZHVlX2RhdGUgPz8gbnVsbCxcclxuICB9O1xyXG4gIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAuZnJvbShcImNhcmRzXCIpXHJcbiAgICAuaW5zZXJ0KGluc2VydClcclxuICAgIC5zZWxlY3QoXCIqXCIpXHJcbiAgICAuc2luZ2xlKCk7XHJcbiAgaWYgKGVycm9yKVxyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfSwgeyBzdGF0dXM6IDQwMCB9KTtcclxuICAvLyBoaXN0b3J5XHJcbiAgYXdhaXQgc3VwYWJhc2UuZnJvbShcImNhcmRfaGlzdG9yeVwiKS5pbnNlcnQoe1xyXG4gICAgY2FyZF9pZDogZGF0YS5pZCxcclxuICAgIGFjdGlvbjogXCJjcmVhdGVkXCIsXHJcbiAgICBhY3Rvcl9pZCxcclxuICAgIHBheWxvYWQ6IGluc2VydCxcclxuICB9KTtcclxuICAvLyBhdXRvbWF0aW9uczogY2FyZC5jcmVhdGVkXHJcbiAgdHJ5IHtcclxuICAgIGF3YWl0IGRpc3BhdGNoQXV0b21hdGlvbkZvckV2ZW50KHtcclxuICAgICAgdHlwZTogXCJjYXJkLmNyZWF0ZWRcIixcclxuICAgICAgYm9hcmRfaWQ6IGRhdGEuYm9hcmRfaWQsXHJcbiAgICAgIGNhcmRfaWQ6IGRhdGEuaWQsXHJcbiAgICAgIGxpc3RfaWQ6IGRhdGEubGlzdF9pZCxcclxuICAgIH0pO1xyXG4gIH0gY2F0Y2gge31cclxuICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBkYXRhIH0pO1xyXG59XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUEFUQ0gocmVxOiBOZXh0UmVxdWVzdCkge1xyXG4gIGNvbnN0IHN1cGFiYXNlID0gZ2V0U3VwYWJhc2VTZXJ2ZXJDbGllbnQoKTtcclxuICBjb25zdCBib2R5ID0gYXdhaXQgcmVxLmpzb24oKTtcclxuICBjb25zdCB7IGlkLCAuLi5yZXN0IH0gPSBib2R5ID8/IHt9O1xyXG4gIGlmICghaWQpXHJcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogXCJpZCDDqSBvYnJpZ2F0w7NyaW9cIiB9LCB7IHN0YXR1czogNDIyIH0pO1xyXG4gIC8vIGlkZW50aWZpY2EgYXRvclxyXG4gIGxldCBhY3Rvcl9pZDogc3RyaW5nIHwgbnVsbCA9IG51bGw7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGhkciA9IHJlcS5oZWFkZXJzLmdldChcImF1dGhvcml6YXRpb25cIikgPz8gcmVxLmhlYWRlcnMuZ2V0KFwieC1zYi1hY2Nlc3MtdG9rZW5cIikgPz8gXCJcIjtcclxuICAgIGNvbnN0IHRva2VuSGVhZGVyID0gaGRyPy50b0xvd2VyQ2FzZSgpLnN0YXJ0c1dpdGgoXCJiZWFyZXIgXCIpID8gaGRyLnNsaWNlKDcpIDogaGRyIHx8IHVuZGVmaW5lZDtcclxuICAgIGNvbnN0IHRva2VuID0gdG9rZW5IZWFkZXIgPz8gY29va2llcygpLmdldChcInNiLWFjY2Vzcy10b2tlblwiKT8udmFsdWU7XHJcbiAgICBpZiAodG9rZW4pIHtcclxuICAgICAgY29uc3QgeyBkYXRhOiBhdXRoVXNlciB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKHRva2VuKTtcclxuICAgICAgYWN0b3JfaWQgPSBhdXRoVXNlcj8udXNlcj8uaWQgPz8gbnVsbDtcclxuICAgIH1cclxuICB9IGNhdGNoIHt9XHJcbiAgLy8gZXN0YWRvIGFudGVyaW9yXHJcbiAgY29uc3QgeyBkYXRhOiBiZWZvcmUgfSA9IGF3YWl0IHN1cGFiYXNlLmZyb20oXCJjYXJkc1wiKS5zZWxlY3QoXCIqXCIpLmVxKFwiaWRcIiwgaWQpLnNpbmdsZSgpO1xyXG4gIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAuZnJvbShcImNhcmRzXCIpXHJcbiAgICAudXBkYXRlKHJlc3QpXHJcbiAgICAuZXEoXCJpZFwiLCBpZClcclxuICAgIC5zZWxlY3QoXCIqXCIpXHJcbiAgICAuc2luZ2xlKCk7XHJcbiAgaWYgKGVycm9yKVxyXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfSwgeyBzdGF0dXM6IDQwMCB9KTtcclxuICBhd2FpdCBzdXBhYmFzZS5mcm9tKFwiY2FyZF9oaXN0b3J5XCIpLmluc2VydCh7XHJcbiAgICBjYXJkX2lkOiBkYXRhLmlkLFxyXG4gICAgYWN0aW9uOiBcInVwZGF0ZWRcIixcclxuICAgIGFjdG9yX2lkLFxyXG4gICAgcGF5bG9hZDogeyBiZWZvcmUsIGFmdGVyOiByZXN0IH0sXHJcbiAgfSk7XHJcbiAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZGF0YSB9KTtcclxufVxyXG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiZ2V0U3VwYWJhc2VTZXJ2ZXJDbGllbnQiLCJkaXNwYXRjaEF1dG9tYXRpb25Gb3JFdmVudCIsImNvb2tpZXMiLCJQT1NUIiwicmVxIiwic3VwYWJhc2UiLCJib2R5IiwianNvbiIsInRpdGxlIiwiYm9hcmRfaWQiLCJsaXN0X2lkIiwicG9zaXRpb24iLCJkZXNjcmlwdGlvbiIsImR1ZV9kYXRlIiwiZXJyb3IiLCJzdGF0dXMiLCJhY3Rvcl9pZCIsImhkciIsImhlYWRlcnMiLCJnZXQiLCJ0b2tlbkhlYWRlciIsInRvTG93ZXJDYXNlIiwic3RhcnRzV2l0aCIsInNsaWNlIiwidW5kZWZpbmVkIiwidG9rZW4iLCJ2YWx1ZSIsImRhdGEiLCJhdXRoVXNlciIsImF1dGgiLCJnZXRVc2VyIiwidXNlciIsImlkIiwiaW5zZXJ0IiwiZnJvbSIsInNlbGVjdCIsInNpbmdsZSIsIm1lc3NhZ2UiLCJjYXJkX2lkIiwiYWN0aW9uIiwicGF5bG9hZCIsInR5cGUiLCJQQVRDSCIsInJlc3QiLCJiZWZvcmUiLCJlcSIsInVwZGF0ZSIsImFmdGVyIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./app/api/cards/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/automation/engine.ts":
/*!**********************************!*\
  !*** ./lib/automation/engine.ts ***!
  \**********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   dispatchAutomationForEvent: () => (/* binding */ dispatchAutomationForEvent),\n/* harmony export */   executeAutomation: () => (/* binding */ executeAutomation)\n/* harmony export */ });\n/* harmony import */ var _lib_supabase_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @/lib/supabase-server */ \"(rsc)/./lib/supabase-server.ts\");\n\nasync function dispatchAutomationForEvent(payload) {\n    const supabase = (0,_lib_supabase_server__WEBPACK_IMPORTED_MODULE_0__.getSupabaseServerClient)();\n    // busca regras do board habilitadas do tipo 'event'\n    const { data: autos } = await supabase.from(\"automations\").select(\"*\").eq(\"board_id\", payload.board_id).eq(\"enabled\", true).eq(\"trigger_type\", \"event\");\n    const candidates = (autos ?? []).filter((a)=>matchEvent(a.trigger_config, payload));\n    let executed = 0;\n    for (const a of candidates){\n        try {\n            await runActions(supabase, a, payload);\n            await supabase.from(\"automation_runs\").insert({\n                automation_id: a.id,\n                status: \"ok\",\n                payload\n            });\n            executed++;\n        } catch (e) {\n            await supabase.from(\"automation_runs\").insert({\n                automation_id: a.id,\n                status: \"error\",\n                payload,\n                error_text: String(e?.message ?? e)\n            });\n        }\n    }\n    return executed;\n}\nfunction matchEvent(config, payload) {\n    if (!config || config.event !== payload.type) return false;\n    // suportes comuns\n    if (payload.type === \"card.moved\") {\n        if (config.to_list_id && config.to_list_id !== payload.to_list_id) return false;\n        if (config.from_list_id != null && config.from_list_id !== payload.from_list_id) return false;\n    }\n    if (payload.type === \"card.created\") {\n        if (config.in_list_id && config.in_list_id !== payload.list_id) return false;\n    }\n    // Demais eventos atualmente não possuem filtros adicionais\n    return true;\n}\nasync function runActions(supabase, a, payload) {\n    for (const action of a.actions ?? []){\n        const type = action?.type;\n        if (!type) continue;\n        if (type === \"add_label\") {\n            const labelId = action.label_id;\n            if (!labelId) continue;\n            await supabase.from(\"card_labels\").insert({\n                card_id: payload.card_id,\n                label_id: labelId\n            }).throwOnError();\n        } else if (type === \"move_to_list\") {\n            const listId = action.list_id;\n            if (!listId) continue;\n            // posição no final\n            const { data: last } = await supabase.from(\"cards\").select(\"position\").eq(\"list_id\", listId).order(\"position\", {\n                ascending: false\n            }).limit(1);\n            const newPos = last && last.length ? (last[0].position ?? 0) + 100 : 100;\n            await supabase.from(\"cards\").update({\n                list_id: listId,\n                position: newPos\n            }).eq(\"id\", payload.card_id).throwOnError();\n        } else if (type === \"set_due_in_days\") {\n            const days = Number(action.days ?? 0);\n            const due = new Date(Date.now() + days * 86400000).toISOString();\n            await supabase.from(\"cards\").update({\n                due_date: due\n            }).eq(\"id\", payload.card_id).throwOnError();\n        } else if (type === \"shift_due_by_days\") {\n            const days = Number(action.days ?? 0);\n            const { data: c } = await supabase.from(\"cards\").select(\"due_date\").eq(\"id\", payload.card_id).single();\n            if (!c?.due_date) continue;\n            const due = new Date(c.due_date);\n            due.setDate(due.getDate() + days);\n            await supabase.from(\"cards\").update({\n                due_date: due.toISOString()\n            }).eq(\"id\", payload.card_id).throwOnError();\n        } else if (type === \"set_start_date\") {\n            const iso = typeof action.value === \"string\" && action.value ? new Date(action.value).toISOString() : new Date().toISOString();\n            await supabase.from(\"cards\").update({\n                start_date: iso\n            }).eq(\"id\", payload.card_id).throwOnError();\n        } else if (type === \"assign_member\") {\n            const userId = action.user_id;\n            if (!userId) continue;\n            await supabase.from(\"card_members\").insert({\n                card_id: payload.card_id,\n                user_id: userId\n            }).throwOnError();\n        } else if (type === \"remove_member\") {\n            const userId = action.user_id;\n            if (!userId) continue;\n            await supabase.from(\"card_members\").delete().match({\n                card_id: payload.card_id,\n                user_id: userId\n            }).throwOnError();\n        } else if (type === \"create_checklist\") {\n            const title = String(action.title ?? \"Checklist\");\n            const { data: cl } = await supabase.from(\"checklists\").insert({\n                card_id: payload.card_id,\n                title\n            }).select(\"*\").single();\n            if (action.items && Array.isArray(action.items) && cl?.id) {\n                let pos = 100;\n                for (const it of action.items){\n                    await supabase.from(\"checklist_items\").insert({\n                        checklist_id: cl.id,\n                        title: String(it ?? \"\"),\n                        position: pos,\n                        done: false\n                    }).throwOnError();\n                    pos += 100;\n                }\n            }\n        } else if (type === \"add_checklist_item\") {\n            const checklistId = action.checklist_id;\n            const title = String(action.title ?? \"\");\n            if (!checklistId || !title) continue;\n            const { data: last } = await supabase.from(\"checklist_items\").select(\"position\").eq(\"checklist_id\", checklistId).order(\"position\", {\n                ascending: false\n            }).limit(1);\n            const newPos = last && last.length ? (last[0].position ?? 0) + 100 : 100;\n            await supabase.from(\"checklist_items\").insert({\n                checklist_id: checklistId,\n                title,\n                position: newPos,\n                done: false\n            }).throwOnError();\n        } else if (type === \"complete_checklist_item\") {\n            const itemId = action.item_id;\n            if (!itemId) continue;\n            await supabase.from(\"checklist_items\").update({\n                done: true\n            }).eq(\"id\", itemId).throwOnError();\n        } else if (type === \"move_to_top\" || type === \"move_to_bottom\") {\n            const { data: c } = await supabase.from(\"cards\").select(\"list_id\").eq(\"id\", payload.card_id).single();\n            if (!c?.list_id) continue;\n            if (type === \"move_to_top\") {\n                const { data: first } = await supabase.from(\"cards\").select(\"position\").eq(\"list_id\", c.list_id).order(\"position\", {\n                    ascending: true\n                }).limit(1);\n                const newPos = first && first.length ? (first[0].position ?? 100) - 50 : 100;\n                await supabase.from(\"cards\").update({\n                    position: newPos\n                }).eq(\"id\", payload.card_id).throwOnError();\n            } else {\n                const { data: last } = await supabase.from(\"cards\").select(\"position\").eq(\"list_id\", c.list_id).order(\"position\", {\n                    ascending: false\n                }).limit(1);\n                const newPos = last && last.length ? (last[0].position ?? 0) + 100 : 100;\n                await supabase.from(\"cards\").update({\n                    position: newPos\n                }).eq(\"id\", payload.card_id).throwOnError();\n            }\n        } else if (type === \"comment\") {\n            const text = String(action.text ?? \"\").trim();\n            if (!text) continue;\n            try {\n                await supabase.from(\"card_comments\").insert({\n                    card_id: payload.card_id,\n                    content: text,\n                    author_id: payload?.actor_id ?? null\n                }).throwOnError();\n            } catch (e) {\n                // Fallback: tenta encontrar algum membro do workspace do board para registrar como autor\n                try {\n                    const { data: b } = await supabase.from(\"boards\").select(\"workspace_id\").eq(\"id\", payload.board_id).single();\n                    if (b?.workspace_id) {\n                        const { data: wm } = await supabase.from(\"workspace_members\").select(\"user_id\").eq(\"workspace_id\", b.workspace_id).limit(1);\n                        const fallbackUser = wm?.[0]?.user_id;\n                        await supabase.from(\"card_comments\").insert({\n                            card_id: payload.card_id,\n                            content: text,\n                            author_id: fallbackUser ?? null\n                        }).throwOnError();\n                    } else {\n                        await supabase.from(\"card_comments\").insert({\n                            card_id: payload.card_id,\n                            content: text\n                        }).throwOnError();\n                    }\n                } catch  {}\n            }\n        // também incrementa contador por consistência (realtime deve atualizar, mas garantimos persistência)\n        } else if (type === \"archive_now\") {\n            const now = new Date().toISOString();\n            await supabase.from(\"cards\").update({\n                archived_at: now\n            }).eq(\"id\", payload.card_id).throwOnError();\n        } else if (type === \"assign_member\") {\n            const userId = action.user_id;\n            if (!userId) continue;\n            await supabase.from(\"card_members\").insert({\n                card_id: payload.card_id,\n                user_id: userId\n            }).throwOnError();\n        } else if (type === \"remove_member\") {\n            const userId = action.user_id;\n            if (!userId) continue;\n            await supabase.from(\"card_members\").delete().match({\n                card_id: payload.card_id,\n                user_id: userId\n            }).throwOnError();\n        } else if (type === \"set_start_date\") {\n            const when = action.when; // e.g. \"now\" | ISO\n            const start = when === \"now\" || !when ? new Date().toISOString() : when;\n            await supabase.from(\"cards\").update({\n                start_date: start\n            }).eq(\"id\", payload.card_id).throwOnError();\n        } else if (type === \"shift_due_by_days\") {\n            const days = Number(action.days ?? 0);\n            const { data: c } = await supabase.from(\"cards\").select(\"due_date\").eq(\"id\", payload.card_id).single();\n            const base = c?.due_date ? new Date(c.due_date).getTime() : Date.now();\n            const due = new Date(base + days * 86400000).toISOString();\n            await supabase.from(\"cards\").update({\n                due_date: due\n            }).eq(\"id\", payload.card_id).throwOnError();\n        } else if (type === \"create_checklist\") {\n            const title = String(action.title ?? \"Checklist\").trim();\n            const items = Array.isArray(action.items) ? action.items : [];\n            const { data: cl } = await supabase.from(\"checklists\").insert({\n                title,\n                card_id: payload.card_id\n            }).select(\"*\").single();\n            let pos = 100;\n            for (const it of items){\n                await supabase.from(\"checklist_items\").insert({\n                    title: it,\n                    checklist_id: cl.id,\n                    done: false,\n                    position: pos\n                });\n                pos += 100;\n            }\n        } else if (type === \"move_to_top\" || type === \"move_to_bottom\") {\n            // precisa da lista atual\n            const { data: c } = await supabase.from(\"cards\").select(\"list_id\").eq(\"id\", payload.card_id).single();\n            const listId = c?.list_id;\n            if (!listId) continue;\n            if (type === \"move_to_top\") {\n                const { data: first } = await supabase.from(\"cards\").select(\"position\").eq(\"list_id\", listId).order(\"position\", {\n                    ascending: true\n                }).limit(1);\n                const newPos = first && first.length ? Math.max(0, first[0].position - 100) : 100;\n                await supabase.from(\"cards\").update({\n                    position: newPos\n                }).eq(\"id\", payload.card_id);\n            } else {\n                const { data: last } = await supabase.from(\"cards\").select(\"position\").eq(\"list_id\", listId).order(\"position\", {\n                    ascending: false\n                }).limit(1);\n                const newPos = last && last.length ? last[0].position + 100 : 100;\n                await supabase.from(\"cards\").update({\n                    position: newPos\n                }).eq(\"id\", payload.card_id);\n            }\n        }\n    }\n}\n// Executa uma automação arbitrária (útil para gatilhos por agendamento/duedate)\nasync function executeAutomation(automation, payload) {\n    const supabase = (0,_lib_supabase_server__WEBPACK_IMPORTED_MODULE_0__.getSupabaseServerClient)();\n    try {\n        await runActions(supabase, automation, payload);\n        await supabase.from(\"automation_runs\").insert({\n            automation_id: automation.id,\n            status: \"ok\",\n            payload\n        });\n    } catch (e) {\n        await supabase.from(\"automation_runs\").insert({\n            automation_id: automation.id,\n            status: \"error\",\n            payload,\n            error_text: String(e?.message ?? e)\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFHLE1BQU07Z0JBQzFELE1BQU0xQyxTQUNIRyxJQUFJLENBQUMsU0FDTHdDLE1BQU0sQ0FBQztvQkFBRUQsVUFBVUY7Z0JBQU8sR0FDMUJuQyxFQUFFLENBQUMsTUFBTU4sUUFBUWtDLE9BQU87WUFDN0I7UUFDRjtJQUNGO0FBQ0Y7QUFFQSxnRkFBZ0Y7QUFDekUsZUFBZTBELGtCQUNwQkMsVUFBc0IsRUFDdEI3RixPQUFxQjtJQUVyQixNQUFNQyxXQUFXSCw2RUFBdUJBO0lBQ3hDLElBQUk7UUFDRixNQUFNZ0IsV0FBV2IsVUFBVTRGLFlBQVk3RjtRQUN2QyxNQUFNQyxTQUNIRyxJQUFJLENBQUMsbUJBQ0xXLE1BQU0sQ0FBQztZQUFFQyxlQUFlNkUsV0FBVzVFLEVBQUU7WUFBRUMsUUFBUTtZQUFNbEI7UUFBUTtJQUNsRSxFQUFFLE9BQU9tQixHQUFRO1FBQ2YsTUFBTWxCLFNBQ0hHLElBQUksQ0FBQyxtQkFDTFcsTUFBTSxDQUFDO1lBQ05DLGVBQWU2RSxXQUFXNUUsRUFBRTtZQUM1QkMsUUFBUTtZQUNSbEI7WUFDQW9CLFlBQVlDLE9BQU9GLEdBQUdHLFdBQVdIO1FBQ25DO0lBQ0o7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL2thbmJhbnByby8uL2xpYi9hdXRvbWF0aW9uL2VuZ2luZS50cz8xYTlmIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGdldFN1cGFiYXNlU2VydmVyQ2xpZW50IH0gZnJvbSBcIkAvbGliL3N1cGFiYXNlLXNlcnZlclwiO1xyXG5cclxudHlwZSBFdmVudFBheWxvYWQgPSB7XHJcbiAgdHlwZTogc3RyaW5nOyAvLyBcImNhcmQubW92ZWRcIiB8IFwiY2FyZC5jcmVhdGVkXCIgfCBcImxhYmVsLmFkZGVkXCIgfCBcImxhYmVsLnJlbW92ZWRcIiB8IFwiY2hlY2tsaXN0LmNvbXBsZXRlZFwiIHwgXCJkdWUuYXBwcm9hY2hpbmdcIiB8IFwiZHVlLnBhc3RcIiB8IFwiY29tbWVudC5wb3N0ZWRcIiB8IFwiYXR0YWNobWVudC5hZGRlZFwiIHwgXCJjb3Zlci5jaGFuZ2VkXCIgfCBcImR1ZS5jaGFuZ2VkXCIgfCBcInN0YXJ0LmNoYW5nZWRcIiB8IFwiY2FyZC5hcmNoaXZlZFwiIHwgXCJjYXJkLnJlc3RvcmVkXCIgfCBcImNhcmQuZGVsZXRlZFwiXHJcbiAgYm9hcmRfaWQ6IHN0cmluZztcclxuICBjYXJkX2lkOiBzdHJpbmc7XHJcbiAgZnJvbV9saXN0X2lkPzogc3RyaW5nIHwgbnVsbDtcclxuICB0b19saXN0X2lkPzogc3RyaW5nO1xyXG4gIGxpc3RfaWQ/OiBzdHJpbmc7XHJcbn07XHJcblxyXG50eXBlIEF1dG9tYXRpb24gPSB7XHJcbiAgaWQ6IHN0cmluZztcclxuICBib2FyZF9pZDogc3RyaW5nO1xyXG4gIGVuYWJsZWQ6IGJvb2xlYW47XHJcbiAgdHJpZ2dlcl90eXBlOiBcImV2ZW50XCIgfCBcInNjaGVkdWxlXCIgfCBcImR1ZVwiO1xyXG4gIHRyaWdnZXJfY29uZmlnOiBhbnk7XHJcbiAgYWN0aW9uczogYW55W107XHJcbn07XHJcblxyXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZGlzcGF0Y2hBdXRvbWF0aW9uRm9yRXZlbnQocGF5bG9hZDogRXZlbnRQYXlsb2FkKTogUHJvbWlzZTxudW1iZXI+IHtcclxuICBjb25zdCBzdXBhYmFzZSA9IGdldFN1cGFiYXNlU2VydmVyQ2xpZW50KCk7XHJcbiAgLy8gYnVzY2EgcmVncmFzIGRvIGJvYXJkIGhhYmlsaXRhZGFzIGRvIHRpcG8gJ2V2ZW50J1xyXG4gIGNvbnN0IHsgZGF0YTogYXV0b3MgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAuZnJvbShcImF1dG9tYXRpb25zXCIpXHJcbiAgICAuc2VsZWN0KFwiKlwiKVxyXG4gICAgLmVxKFwiYm9hcmRfaWRcIiwgcGF5bG9hZC5ib2FyZF9pZClcclxuICAgIC5lcShcImVuYWJsZWRcIiwgdHJ1ZSlcclxuICAgIC5lcShcInRyaWdnZXJfdHlwZVwiLCBcImV2ZW50XCIpO1xyXG4gIGNvbnN0IGNhbmRpZGF0ZXMgPSAoYXV0b3MgPz8gW10pLmZpbHRlcigoYTogYW55KSA9PlxyXG4gICAgbWF0Y2hFdmVudChhLnRyaWdnZXJfY29uZmlnLCBwYXlsb2FkKVxyXG4gICkgYXMgQXV0b21hdGlvbltdO1xyXG4gIGxldCBleGVjdXRlZCA9IDA7XHJcbiAgZm9yIChjb25zdCBhIG9mIGNhbmRpZGF0ZXMpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIGF3YWl0IHJ1bkFjdGlvbnMoc3VwYWJhc2UsIGEsIHBheWxvYWQpO1xyXG4gICAgICBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKFwiYXV0b21hdGlvbl9ydW5zXCIpXHJcbiAgICAgICAgLmluc2VydCh7IGF1dG9tYXRpb25faWQ6IGEuaWQsIHN0YXR1czogXCJva1wiLCBwYXlsb2FkIH0pO1xyXG4gICAgICBleGVjdXRlZCsrO1xyXG4gICAgfSBjYXRjaCAoZTogYW55KSB7XHJcbiAgICAgIGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oXCJhdXRvbWF0aW9uX3J1bnNcIilcclxuICAgICAgICAuaW5zZXJ0KHtcclxuICAgICAgICAgIGF1dG9tYXRpb25faWQ6IGEuaWQsXHJcbiAgICAgICAgICBzdGF0dXM6IFwiZXJyb3JcIixcclxuICAgICAgICAgIHBheWxvYWQsXHJcbiAgICAgICAgICBlcnJvcl90ZXh0OiBTdHJpbmcoZT8ubWVzc2FnZSA/PyBlKSxcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcbiAgcmV0dXJuIGV4ZWN1dGVkO1xyXG59XHJcblxyXG5mdW5jdGlvbiBtYXRjaEV2ZW50KGNvbmZpZzogYW55LCBwYXlsb2FkOiBFdmVudFBheWxvYWQpIHtcclxuICBpZiAoIWNvbmZpZyB8fCBjb25maWcuZXZlbnQgIT09IHBheWxvYWQudHlwZSkgcmV0dXJuIGZhbHNlO1xyXG4gIC8vIHN1cG9ydGVzIGNvbXVuc1xyXG4gIGlmIChwYXlsb2FkLnR5cGUgPT09IFwiY2FyZC5tb3ZlZFwiKSB7XHJcbiAgICBpZiAoY29uZmlnLnRvX2xpc3RfaWQgJiYgY29uZmlnLnRvX2xpc3RfaWQgIT09IHBheWxvYWQudG9fbGlzdF9pZClcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgaWYgKFxyXG4gICAgICBjb25maWcuZnJvbV9saXN0X2lkICE9IG51bGwgJiZcclxuICAgICAgY29uZmlnLmZyb21fbGlzdF9pZCAhPT0gcGF5bG9hZC5mcm9tX2xpc3RfaWRcclxuICAgIClcclxuICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuICBpZiAocGF5bG9hZC50eXBlID09PSBcImNhcmQuY3JlYXRlZFwiKSB7XHJcbiAgICBpZiAoY29uZmlnLmluX2xpc3RfaWQgJiYgY29uZmlnLmluX2xpc3RfaWQgIT09IHBheWxvYWQubGlzdF9pZCkgcmV0dXJuIGZhbHNlO1xyXG4gIH1cclxuICAvLyBEZW1haXMgZXZlbnRvcyBhdHVhbG1lbnRlIG7Do28gcG9zc3VlbSBmaWx0cm9zIGFkaWNpb25haXNcclxuICByZXR1cm4gdHJ1ZTtcclxufVxyXG5cclxuYXN5bmMgZnVuY3Rpb24gcnVuQWN0aW9ucyhcclxuICBzdXBhYmFzZTogUmV0dXJuVHlwZTx0eXBlb2YgZ2V0U3VwYWJhc2VTZXJ2ZXJDbGllbnQ+LFxyXG4gIGE6IEF1dG9tYXRpb24sXHJcbiAgcGF5bG9hZDogRXZlbnRQYXlsb2FkXHJcbikge1xyXG4gIGZvciAoY29uc3QgYWN0aW9uIG9mIGEuYWN0aW9ucyA/PyBbXSkge1xyXG4gICAgY29uc3QgdHlwZSA9IGFjdGlvbj8udHlwZSBhcyBzdHJpbmc7XHJcbiAgICBpZiAoIXR5cGUpIGNvbnRpbnVlO1xyXG4gICAgaWYgKHR5cGUgPT09IFwiYWRkX2xhYmVsXCIpIHtcclxuICAgICAgY29uc3QgbGFiZWxJZCA9IGFjdGlvbi5sYWJlbF9pZCBhcyBzdHJpbmc7XHJcbiAgICAgIGlmICghbGFiZWxJZCkgY29udGludWU7XHJcbiAgICAgIGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oXCJjYXJkX2xhYmVsc1wiKVxyXG4gICAgICAgIC5pbnNlcnQoeyBjYXJkX2lkOiBwYXlsb2FkLmNhcmRfaWQsIGxhYmVsX2lkOiBsYWJlbElkIH0pXHJcbiAgICAgICAgLnRocm93T25FcnJvcigpO1xyXG4gICAgfSBlbHNlIGlmICh0eXBlID09PSBcIm1vdmVfdG9fbGlzdFwiKSB7XHJcbiAgICAgIGNvbnN0IGxpc3RJZCA9IGFjdGlvbi5saXN0X2lkIGFzIHN0cmluZztcclxuICAgICAgaWYgKCFsaXN0SWQpIGNvbnRpbnVlO1xyXG4gICAgICAvLyBwb3Npw6fDo28gbm8gZmluYWxcclxuICAgICAgY29uc3QgeyBkYXRhOiBsYXN0IH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKFwiY2FyZHNcIilcclxuICAgICAgICAuc2VsZWN0KFwicG9zaXRpb25cIilcclxuICAgICAgICAuZXEoXCJsaXN0X2lkXCIsIGxpc3RJZClcclxuICAgICAgICAub3JkZXIoXCJwb3NpdGlvblwiLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcclxuICAgICAgICAubGltaXQoMSk7XHJcbiAgICAgIGNvbnN0IG5ld1BvcyA9XHJcbiAgICAgICAgbGFzdCAmJiAobGFzdCBhcyBhbnlbXSkubGVuZ3RoID8gKChsYXN0IGFzIGFueSlbMF0ucG9zaXRpb24gPz8gMCkgKyAxMDAgOiAxMDA7XHJcbiAgICAgIGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oXCJjYXJkc1wiKVxyXG4gICAgICAgIC51cGRhdGUoeyBsaXN0X2lkOiBsaXN0SWQsIHBvc2l0aW9uOiBuZXdQb3MgfSlcclxuICAgICAgICAuZXEoXCJpZFwiLCBwYXlsb2FkLmNhcmRfaWQpXHJcbiAgICAgICAgLnRocm93T25FcnJvcigpO1xyXG4gICAgfSBlbHNlIGlmICh0eXBlID09PSBcInNldF9kdWVfaW5fZGF5c1wiKSB7XHJcbiAgICAgIGNvbnN0IGRheXMgPSBOdW1iZXIoYWN0aW9uLmRheXMgPz8gMCk7XHJcbiAgICAgIGNvbnN0IGR1ZSA9IG5ldyBEYXRlKERhdGUubm93KCkgKyBkYXlzICogODY0MDAwMDApLnRvSVNPU3RyaW5nKCk7XHJcbiAgICAgIGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oXCJjYXJkc1wiKVxyXG4gICAgICAgIC51cGRhdGUoeyBkdWVfZGF0ZTogZHVlIH0pXHJcbiAgICAgICAgLmVxKFwiaWRcIiwgcGF5bG9hZC5jYXJkX2lkKVxyXG4gICAgICAgIC50aHJvd09uRXJyb3IoKTtcclxuICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJzaGlmdF9kdWVfYnlfZGF5c1wiKSB7XHJcbiAgICAgIGNvbnN0IGRheXMgPSBOdW1iZXIoYWN0aW9uLmRheXMgPz8gMCk7XHJcbiAgICAgIGNvbnN0IHsgZGF0YTogYyB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbShcImNhcmRzXCIpXHJcbiAgICAgICAgLnNlbGVjdChcImR1ZV9kYXRlXCIpXHJcbiAgICAgICAgLmVxKFwiaWRcIiwgcGF5bG9hZC5jYXJkX2lkKVxyXG4gICAgICAgIC5zaW5nbGUoKTtcclxuICAgICAgaWYgKCFjPy5kdWVfZGF0ZSkgY29udGludWU7XHJcbiAgICAgIGNvbnN0IGR1ZSA9IG5ldyBEYXRlKGMuZHVlX2RhdGUpO1xyXG4gICAgICBkdWUuc2V0RGF0ZShkdWUuZ2V0RGF0ZSgpICsgZGF5cyk7XHJcbiAgICAgIGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oXCJjYXJkc1wiKVxyXG4gICAgICAgIC51cGRhdGUoeyBkdWVfZGF0ZTogZHVlLnRvSVNPU3RyaW5nKCkgfSlcclxuICAgICAgICAuZXEoXCJpZFwiLCBwYXlsb2FkLmNhcmRfaWQpXHJcbiAgICAgICAgLnRocm93T25FcnJvcigpO1xyXG4gICAgfSBlbHNlIGlmICh0eXBlID09PSBcInNldF9zdGFydF9kYXRlXCIpIHtcclxuICAgICAgY29uc3QgaXNvID1cclxuICAgICAgICB0eXBlb2YgYWN0aW9uLnZhbHVlID09PSBcInN0cmluZ1wiICYmIGFjdGlvbi52YWx1ZVxyXG4gICAgICAgICAgPyBuZXcgRGF0ZShhY3Rpb24udmFsdWUpLnRvSVNPU3RyaW5nKClcclxuICAgICAgICAgIDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xyXG4gICAgICBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKFwiY2FyZHNcIilcclxuICAgICAgICAudXBkYXRlKHsgc3RhcnRfZGF0ZTogaXNvIH0pXHJcbiAgICAgICAgLmVxKFwiaWRcIiwgcGF5bG9hZC5jYXJkX2lkKVxyXG4gICAgICAgIC50aHJvd09uRXJyb3IoKTtcclxuICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJhc3NpZ25fbWVtYmVyXCIpIHtcclxuICAgICAgY29uc3QgdXNlcklkID0gYWN0aW9uLnVzZXJfaWQgYXMgc3RyaW5nO1xyXG4gICAgICBpZiAoIXVzZXJJZCkgY29udGludWU7XHJcbiAgICAgIGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oXCJjYXJkX21lbWJlcnNcIilcclxuICAgICAgICAuaW5zZXJ0KHsgY2FyZF9pZDogcGF5bG9hZC5jYXJkX2lkLCB1c2VyX2lkOiB1c2VySWQgfSlcclxuICAgICAgICAudGhyb3dPbkVycm9yKCk7XHJcbiAgICB9IGVsc2UgaWYgKHR5cGUgPT09IFwicmVtb3ZlX21lbWJlclwiKSB7XHJcbiAgICAgIGNvbnN0IHVzZXJJZCA9IGFjdGlvbi51c2VyX2lkIGFzIHN0cmluZztcclxuICAgICAgaWYgKCF1c2VySWQpIGNvbnRpbnVlO1xyXG4gICAgICBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKFwiY2FyZF9tZW1iZXJzXCIpXHJcbiAgICAgICAgLmRlbGV0ZSgpXHJcbiAgICAgICAgLm1hdGNoKHsgY2FyZF9pZDogcGF5bG9hZC5jYXJkX2lkLCB1c2VyX2lkOiB1c2VySWQgfSlcclxuICAgICAgICAudGhyb3dPbkVycm9yKCk7XHJcbiAgICB9IGVsc2UgaWYgKHR5cGUgPT09IFwiY3JlYXRlX2NoZWNrbGlzdFwiKSB7XHJcbiAgICAgIGNvbnN0IHRpdGxlID0gU3RyaW5nKGFjdGlvbi50aXRsZSA/PyBcIkNoZWNrbGlzdFwiKTtcclxuICAgICAgY29uc3QgeyBkYXRhOiBjbCB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbShcImNoZWNrbGlzdHNcIilcclxuICAgICAgICAuaW5zZXJ0KHsgY2FyZF9pZDogcGF5bG9hZC5jYXJkX2lkLCB0aXRsZSB9KVxyXG4gICAgICAgIC5zZWxlY3QoXCIqXCIpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG4gICAgICBpZiAoYWN0aW9uLml0ZW1zICYmIEFycmF5LmlzQXJyYXkoYWN0aW9uLml0ZW1zKSAmJiBjbD8uaWQpIHtcclxuICAgICAgICBsZXQgcG9zID0gMTAwO1xyXG4gICAgICAgIGZvciAoY29uc3QgaXQgb2YgYWN0aW9uLml0ZW1zKSB7XHJcbiAgICAgICAgICBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgICAgICAuZnJvbShcImNoZWNrbGlzdF9pdGVtc1wiKVxyXG4gICAgICAgICAgICAuaW5zZXJ0KHtcclxuICAgICAgICAgICAgICBjaGVja2xpc3RfaWQ6IGNsLmlkLFxyXG4gICAgICAgICAgICAgIHRpdGxlOiBTdHJpbmcoaXQgPz8gXCJcIiksXHJcbiAgICAgICAgICAgICAgcG9zaXRpb246IHBvcyxcclxuICAgICAgICAgICAgICBkb25lOiBmYWxzZSxcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnRocm93T25FcnJvcigpO1xyXG4gICAgICAgICAgcG9zICs9IDEwMDtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJhZGRfY2hlY2tsaXN0X2l0ZW1cIikge1xyXG4gICAgICBjb25zdCBjaGVja2xpc3RJZCA9IGFjdGlvbi5jaGVja2xpc3RfaWQgYXMgc3RyaW5nO1xyXG4gICAgICBjb25zdCB0aXRsZSA9IFN0cmluZyhhY3Rpb24udGl0bGUgPz8gXCJcIik7XHJcbiAgICAgIGlmICghY2hlY2tsaXN0SWQgfHwgIXRpdGxlKSBjb250aW51ZTtcclxuICAgICAgY29uc3QgeyBkYXRhOiBsYXN0IH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKFwiY2hlY2tsaXN0X2l0ZW1zXCIpXHJcbiAgICAgICAgLnNlbGVjdChcInBvc2l0aW9uXCIpXHJcbiAgICAgICAgLmVxKFwiY2hlY2tsaXN0X2lkXCIsIGNoZWNrbGlzdElkKVxyXG4gICAgICAgIC5vcmRlcihcInBvc2l0aW9uXCIsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KVxyXG4gICAgICAgIC5saW1pdCgxKTtcclxuICAgICAgY29uc3QgbmV3UG9zID1cclxuICAgICAgICBsYXN0ICYmIChsYXN0IGFzIGFueVtdKS5sZW5ndGggPyAoKGxhc3QgYXMgYW55KVswXS5wb3NpdGlvbiA/PyAwKSArIDEwMCA6IDEwMDtcclxuICAgICAgYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbShcImNoZWNrbGlzdF9pdGVtc1wiKVxyXG4gICAgICAgIC5pbnNlcnQoeyBjaGVja2xpc3RfaWQ6IGNoZWNrbGlzdElkLCB0aXRsZSwgcG9zaXRpb246IG5ld1BvcywgZG9uZTogZmFsc2UgfSlcclxuICAgICAgICAudGhyb3dPbkVycm9yKCk7XHJcbiAgICB9IGVsc2UgaWYgKHR5cGUgPT09IFwiY29tcGxldGVfY2hlY2tsaXN0X2l0ZW1cIikge1xyXG4gICAgICBjb25zdCBpdGVtSWQgPSBhY3Rpb24uaXRlbV9pZCBhcyBzdHJpbmc7XHJcbiAgICAgIGlmICghaXRlbUlkKSBjb250aW51ZTtcclxuICAgICAgYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbShcImNoZWNrbGlzdF9pdGVtc1wiKVxyXG4gICAgICAgIC51cGRhdGUoeyBkb25lOiB0cnVlIH0pXHJcbiAgICAgICAgLmVxKFwiaWRcIiwgaXRlbUlkKVxyXG4gICAgICAgIC50aHJvd09uRXJyb3IoKTtcclxuICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJtb3ZlX3RvX3RvcFwiIHx8IHR5cGUgPT09IFwibW92ZV90b19ib3R0b21cIikge1xyXG4gICAgICBjb25zdCB7IGRhdGE6IGMgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oXCJjYXJkc1wiKVxyXG4gICAgICAgIC5zZWxlY3QoXCJsaXN0X2lkXCIpXHJcbiAgICAgICAgLmVxKFwiaWRcIiwgcGF5bG9hZC5jYXJkX2lkKVxyXG4gICAgICAgIC5zaW5nbGUoKTtcclxuICAgICAgaWYgKCFjPy5saXN0X2lkKSBjb250aW51ZTtcclxuICAgICAgaWYgKHR5cGUgPT09IFwibW92ZV90b190b3BcIikge1xyXG4gICAgICAgIGNvbnN0IHsgZGF0YTogZmlyc3QgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgICAuZnJvbShcImNhcmRzXCIpXHJcbiAgICAgICAgICAuc2VsZWN0KFwicG9zaXRpb25cIilcclxuICAgICAgICAgIC5lcShcImxpc3RfaWRcIiwgYy5saXN0X2lkKVxyXG4gICAgICAgICAgLm9yZGVyKFwicG9zaXRpb25cIiwgeyBhc2NlbmRpbmc6IHRydWUgfSlcclxuICAgICAgICAgIC5saW1pdCgxKTtcclxuICAgICAgICBjb25zdCBuZXdQb3MgPVxyXG4gICAgICAgICAgZmlyc3QgJiYgKGZpcnN0IGFzIGFueVtdKS5sZW5ndGggPyAoKGZpcnN0IGFzIGFueSlbMF0ucG9zaXRpb24gPz8gMTAwKSAtIDUwIDogMTAwO1xyXG4gICAgICAgIGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgICAuZnJvbShcImNhcmRzXCIpXHJcbiAgICAgICAgICAudXBkYXRlKHsgcG9zaXRpb246IG5ld1BvcyB9KVxyXG4gICAgICAgICAgLmVxKFwiaWRcIiwgcGF5bG9hZC5jYXJkX2lkKVxyXG4gICAgICAgICAgLnRocm93T25FcnJvcigpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnN0IHsgZGF0YTogbGFzdCB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAgIC5mcm9tKFwiY2FyZHNcIilcclxuICAgICAgICAgIC5zZWxlY3QoXCJwb3NpdGlvblwiKVxyXG4gICAgICAgICAgLmVxKFwibGlzdF9pZFwiLCBjLmxpc3RfaWQpXHJcbiAgICAgICAgICAub3JkZXIoXCJwb3NpdGlvblwiLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcclxuICAgICAgICAgIC5saW1pdCgxKTtcclxuICAgICAgICBjb25zdCBuZXdQb3MgPVxyXG4gICAgICAgICAgbGFzdCAmJiAobGFzdCBhcyBhbnlbXSkubGVuZ3RoID8gKChsYXN0IGFzIGFueSlbMF0ucG9zaXRpb24gPz8gMCkgKyAxMDAgOiAxMDA7XHJcbiAgICAgICAgYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAgIC5mcm9tKFwiY2FyZHNcIilcclxuICAgICAgICAgIC51cGRhdGUoeyBwb3NpdGlvbjogbmV3UG9zIH0pXHJcbiAgICAgICAgICAuZXEoXCJpZFwiLCBwYXlsb2FkLmNhcmRfaWQpXHJcbiAgICAgICAgICAudGhyb3dPbkVycm9yKCk7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJjb21tZW50XCIpIHtcclxuICAgICAgY29uc3QgdGV4dCA9IFN0cmluZyhhY3Rpb24udGV4dCA/PyBcIlwiKS50cmltKCk7XHJcbiAgICAgIGlmICghdGV4dCkgY29udGludWU7XHJcbiAgICB0cnkge1xyXG4gICAgICBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKFwiY2FyZF9jb21tZW50c1wiKVxyXG4gICAgICAgIC5pbnNlcnQoe1xyXG4gICAgICAgICAgY2FyZF9pZDogcGF5bG9hZC5jYXJkX2lkLFxyXG4gICAgICAgICAgY29udGVudDogdGV4dCxcclxuICAgICAgICAgIGF1dGhvcl9pZDogKHBheWxvYWQgYXMgYW55KT8uYWN0b3JfaWQgPz8gbnVsbCxcclxuICAgICAgICB9KVxyXG4gICAgICAgIC50aHJvd09uRXJyb3IoKTtcclxuICAgIH0gY2F0Y2ggKGUpIHtcclxuICAgICAgLy8gRmFsbGJhY2s6IHRlbnRhIGVuY29udHJhciBhbGd1bSBtZW1icm8gZG8gd29ya3NwYWNlIGRvIGJvYXJkIHBhcmEgcmVnaXN0cmFyIGNvbW8gYXV0b3JcclxuICAgICAgdHJ5IHtcclxuICAgICAgICBjb25zdCB7IGRhdGE6IGIgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgICAuZnJvbShcImJvYXJkc1wiKVxyXG4gICAgICAgICAgLnNlbGVjdChcIndvcmtzcGFjZV9pZFwiKVxyXG4gICAgICAgICAgLmVxKFwiaWRcIiwgKHBheWxvYWQgYXMgYW55KS5ib2FyZF9pZClcclxuICAgICAgICAgIC5zaW5nbGUoKTtcclxuICAgICAgICBpZiAoYj8ud29ya3NwYWNlX2lkKSB7XHJcbiAgICAgICAgICBjb25zdCB7IGRhdGE6IHdtIH0gPSBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgICAgICAuZnJvbShcIndvcmtzcGFjZV9tZW1iZXJzXCIpXHJcbiAgICAgICAgICAgIC5zZWxlY3QoXCJ1c2VyX2lkXCIpXHJcbiAgICAgICAgICAgIC5lcShcIndvcmtzcGFjZV9pZFwiLCBiLndvcmtzcGFjZV9pZClcclxuICAgICAgICAgICAgLmxpbWl0KDEpO1xyXG4gICAgICAgICAgY29uc3QgZmFsbGJhY2tVc2VyID0gd20/LlswXT8udXNlcl9pZCBhcyBzdHJpbmcgfCB1bmRlZmluZWQ7XHJcbiAgICAgICAgICBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgICAgICAuZnJvbShcImNhcmRfY29tbWVudHNcIilcclxuICAgICAgICAgICAgLmluc2VydCh7XHJcbiAgICAgICAgICAgICAgY2FyZF9pZDogcGF5bG9hZC5jYXJkX2lkLFxyXG4gICAgICAgICAgICAgIGNvbnRlbnQ6IHRleHQsXHJcbiAgICAgICAgICAgICAgYXV0aG9yX2lkOiBmYWxsYmFja1VzZXIgPz8gbnVsbCxcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnRocm93T25FcnJvcigpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgICAgICAuZnJvbShcImNhcmRfY29tbWVudHNcIilcclxuICAgICAgICAgICAgLmluc2VydCh7IGNhcmRfaWQ6IHBheWxvYWQuY2FyZF9pZCwgY29udGVudDogdGV4dCB9KVxyXG4gICAgICAgICAgICAudGhyb3dPbkVycm9yKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGNhdGNoIHt9XHJcbiAgICB9XHJcbiAgICAvLyB0YW1iw6ltIGluY3JlbWVudGEgY29udGFkb3IgcG9yIGNvbnNpc3TDqm5jaWEgKHJlYWx0aW1lIGRldmUgYXR1YWxpemFyLCBtYXMgZ2FyYW50aW1vcyBwZXJzaXN0w6puY2lhKVxyXG4gICAgfSBlbHNlIGlmICh0eXBlID09PSBcImFyY2hpdmVfbm93XCIpIHtcclxuICAgICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKS50b0lTT1N0cmluZygpO1xyXG4gICAgICBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKFwiY2FyZHNcIilcclxuICAgICAgICAudXBkYXRlKHsgYXJjaGl2ZWRfYXQ6IG5vdyB9KVxyXG4gICAgICAgIC5lcShcImlkXCIsIHBheWxvYWQuY2FyZF9pZClcclxuICAgICAgICAudGhyb3dPbkVycm9yKCk7XHJcbiAgICB9IGVsc2UgaWYgKHR5cGUgPT09IFwiYXNzaWduX21lbWJlclwiKSB7XHJcbiAgICAgIGNvbnN0IHVzZXJJZCA9IGFjdGlvbi51c2VyX2lkIGFzIHN0cmluZztcclxuICAgICAgaWYgKCF1c2VySWQpIGNvbnRpbnVlO1xyXG4gICAgICBhd2FpdCBzdXBhYmFzZVxyXG4gICAgICAgIC5mcm9tKFwiY2FyZF9tZW1iZXJzXCIpXHJcbiAgICAgICAgLmluc2VydCh7IGNhcmRfaWQ6IHBheWxvYWQuY2FyZF9pZCwgdXNlcl9pZDogdXNlcklkIH0pXHJcbiAgICAgICAgLnRocm93T25FcnJvcigpO1xyXG4gICAgfSBlbHNlIGlmICh0eXBlID09PSBcInJlbW92ZV9tZW1iZXJcIikge1xyXG4gICAgICBjb25zdCB1c2VySWQgPSBhY3Rpb24udXNlcl9pZCBhcyBzdHJpbmc7XHJcbiAgICAgIGlmICghdXNlcklkKSBjb250aW51ZTtcclxuICAgICAgYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbShcImNhcmRfbWVtYmVyc1wiKVxyXG4gICAgICAgIC5kZWxldGUoKVxyXG4gICAgICAgIC5tYXRjaCh7IGNhcmRfaWQ6IHBheWxvYWQuY2FyZF9pZCwgdXNlcl9pZDogdXNlcklkIH0pXHJcbiAgICAgICAgLnRocm93T25FcnJvcigpO1xyXG4gICAgfSBlbHNlIGlmICh0eXBlID09PSBcInNldF9zdGFydF9kYXRlXCIpIHtcclxuICAgICAgY29uc3Qgd2hlbiA9IGFjdGlvbi53aGVuIGFzIHN0cmluZyB8IHVuZGVmaW5lZDsgLy8gZS5nLiBcIm5vd1wiIHwgSVNPXHJcbiAgICAgIGNvbnN0IHN0YXJ0ID1cclxuICAgICAgICB3aGVuID09PSBcIm5vd1wiIHx8ICF3aGVuID8gbmV3IERhdGUoKS50b0lTT1N0cmluZygpIDogd2hlbjtcclxuICAgICAgYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbShcImNhcmRzXCIpXHJcbiAgICAgICAgLnVwZGF0ZSh7IHN0YXJ0X2RhdGU6IHN0YXJ0IH0pXHJcbiAgICAgICAgLmVxKFwiaWRcIiwgcGF5bG9hZC5jYXJkX2lkKVxyXG4gICAgICAgIC50aHJvd09uRXJyb3IoKTtcclxuICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gXCJzaGlmdF9kdWVfYnlfZGF5c1wiKSB7XHJcbiAgICAgIGNvbnN0IGRheXMgPSBOdW1iZXIoYWN0aW9uLmRheXMgPz8gMCk7XHJcbiAgICAgIGNvbnN0IHsgZGF0YTogYyB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbShcImNhcmRzXCIpXHJcbiAgICAgICAgLnNlbGVjdChcImR1ZV9kYXRlXCIpXHJcbiAgICAgICAgLmVxKFwiaWRcIiwgcGF5bG9hZC5jYXJkX2lkKVxyXG4gICAgICAgIC5zaW5nbGUoKTtcclxuICAgICAgY29uc3QgYmFzZSA9IGM/LmR1ZV9kYXRlID8gbmV3IERhdGUoYy5kdWVfZGF0ZSkuZ2V0VGltZSgpIDogRGF0ZS5ub3coKTtcclxuICAgICAgY29uc3QgZHVlID0gbmV3IERhdGUoYmFzZSArIGRheXMgKiA4NjQwMDAwMCkudG9JU09TdHJpbmcoKTtcclxuICAgICAgYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbShcImNhcmRzXCIpXHJcbiAgICAgICAgLnVwZGF0ZSh7IGR1ZV9kYXRlOiBkdWUgfSlcclxuICAgICAgICAuZXEoXCJpZFwiLCBwYXlsb2FkLmNhcmRfaWQpXHJcbiAgICAgICAgLnRocm93T25FcnJvcigpO1xyXG4gICAgfSBlbHNlIGlmICh0eXBlID09PSBcImNyZWF0ZV9jaGVja2xpc3RcIikge1xyXG4gICAgICBjb25zdCB0aXRsZSA9IFN0cmluZyhhY3Rpb24udGl0bGUgPz8gXCJDaGVja2xpc3RcIikudHJpbSgpO1xyXG4gICAgICBjb25zdCBpdGVtczogc3RyaW5nW10gPSBBcnJheS5pc0FycmF5KGFjdGlvbi5pdGVtcykgPyBhY3Rpb24uaXRlbXMgOiBbXTtcclxuICAgICAgY29uc3QgeyBkYXRhOiBjbCB9ID0gYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAuZnJvbShcImNoZWNrbGlzdHNcIilcclxuICAgICAgICAuaW5zZXJ0KHsgdGl0bGUsIGNhcmRfaWQ6IHBheWxvYWQuY2FyZF9pZCB9KVxyXG4gICAgICAgIC5zZWxlY3QoXCIqXCIpXHJcbiAgICAgICAgLnNpbmdsZSgpO1xyXG4gICAgICBsZXQgcG9zID0gMTAwO1xyXG4gICAgICBmb3IgKGNvbnN0IGl0IG9mIGl0ZW1zKSB7XHJcbiAgICAgICAgYXdhaXQgc3VwYWJhc2VcclxuICAgICAgICAgIC5mcm9tKFwiY2hlY2tsaXN0X2l0ZW1zXCIpXHJcbiAgICAgICAgICAuaW5zZXJ0KHsgdGl0bGU6IGl0LCBjaGVja2xpc3RfaWQ6IGNsLmlkLCBkb25lOiBmYWxzZSwgcG9zaXRpb246IHBvcyB9KTtcclxuICAgICAgICBwb3MgKz0gMTAwO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2UgaWYgKHR5cGUgPT09IFwibW92ZV90b190b3BcIiB8fCB0eXBlID09PSBcIm1vdmVfdG9fYm90dG9tXCIpIHtcclxuICAgICAgLy8gcHJlY2lzYSBkYSBsaXN0YSBhdHVhbFxyXG4gICAgICBjb25zdCB7IGRhdGE6IGMgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgLmZyb20oXCJjYXJkc1wiKVxyXG4gICAgICAgIC5zZWxlY3QoXCJsaXN0X2lkXCIpXHJcbiAgICAgICAgLmVxKFwiaWRcIiwgcGF5bG9hZC5jYXJkX2lkKVxyXG4gICAgICAgIC5zaW5nbGUoKTtcclxuICAgICAgY29uc3QgbGlzdElkID0gYz8ubGlzdF9pZCBhcyBzdHJpbmc7XHJcbiAgICAgIGlmICghbGlzdElkKSBjb250aW51ZTtcclxuICAgICAgaWYgKHR5cGUgPT09IFwibW92ZV90b190b3BcIikge1xyXG4gICAgICAgIGNvbnN0IHsgZGF0YTogZmlyc3QgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgICAuZnJvbShcImNhcmRzXCIpXHJcbiAgICAgICAgICAuc2VsZWN0KFwicG9zaXRpb25cIilcclxuICAgICAgICAgIC5lcShcImxpc3RfaWRcIiwgbGlzdElkKVxyXG4gICAgICAgICAgLm9yZGVyKFwicG9zaXRpb25cIiwgeyBhc2NlbmRpbmc6IHRydWUgfSlcclxuICAgICAgICAgIC5saW1pdCgxKTtcclxuICAgICAgICBjb25zdCBuZXdQb3MgPVxyXG4gICAgICAgICAgZmlyc3QgJiYgZmlyc3QubGVuZ3RoID8gTWF0aC5tYXgoMCwgZmlyc3RbMF0ucG9zaXRpb24gLSAxMDApIDogMTAwO1xyXG4gICAgICAgIGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgICAuZnJvbShcImNhcmRzXCIpXHJcbiAgICAgICAgICAudXBkYXRlKHsgcG9zaXRpb246IG5ld1BvcyB9KVxyXG4gICAgICAgICAgLmVxKFwiaWRcIiwgcGF5bG9hZC5jYXJkX2lkKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zdCB7IGRhdGE6IGxhc3QgfSA9IGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgICAuZnJvbShcImNhcmRzXCIpXHJcbiAgICAgICAgICAuc2VsZWN0KFwicG9zaXRpb25cIilcclxuICAgICAgICAgIC5lcShcImxpc3RfaWRcIiwgbGlzdElkKVxyXG4gICAgICAgICAgLm9yZGVyKFwicG9zaXRpb25cIiwgeyBhc2NlbmRpbmc6IGZhbHNlIH0pXHJcbiAgICAgICAgICAubGltaXQoMSk7XHJcbiAgICAgICAgY29uc3QgbmV3UG9zID1cclxuICAgICAgICAgIGxhc3QgJiYgbGFzdC5sZW5ndGggPyAobGFzdFswXSBhcyBhbnkpLnBvc2l0aW9uICsgMTAwIDogMTAwO1xyXG4gICAgICAgIGF3YWl0IHN1cGFiYXNlXHJcbiAgICAgICAgICAuZnJvbShcImNhcmRzXCIpXHJcbiAgICAgICAgICAudXBkYXRlKHsgcG9zaXRpb246IG5ld1BvcyB9KVxyXG4gICAgICAgICAgLmVxKFwiaWRcIiwgcGF5bG9hZC5jYXJkX2lkKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxufVxyXG5cclxuLy8gRXhlY3V0YSB1bWEgYXV0b21hw6fDo28gYXJiaXRyw6FyaWEgKMO6dGlsIHBhcmEgZ2F0aWxob3MgcG9yIGFnZW5kYW1lbnRvL2R1ZWRhdGUpXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBleGVjdXRlQXV0b21hdGlvbihcclxuICBhdXRvbWF0aW9uOiBBdXRvbWF0aW9uLFxyXG4gIHBheWxvYWQ6IEV2ZW50UGF5bG9hZFxyXG4pIHtcclxuICBjb25zdCBzdXBhYmFzZSA9IGdldFN1cGFiYXNlU2VydmVyQ2xpZW50KCk7XHJcbiAgdHJ5IHtcclxuICAgIGF3YWl0IHJ1bkFjdGlvbnMoc3VwYWJhc2UsIGF1dG9tYXRpb24sIHBheWxvYWQpO1xyXG4gICAgYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oXCJhdXRvbWF0aW9uX3J1bnNcIilcclxuICAgICAgLmluc2VydCh7IGF1dG9tYXRpb25faWQ6IGF1dG9tYXRpb24uaWQsIHN0YXR1czogXCJva1wiLCBwYXlsb2FkIH0pO1xyXG4gIH0gY2F0Y2ggKGU6IGFueSkge1xyXG4gICAgYXdhaXQgc3VwYWJhc2VcclxuICAgICAgLmZyb20oXCJhdXRvbWF0aW9uX3J1bnNcIilcclxuICAgICAgLmluc2VydCh7XHJcbiAgICAgICAgYXV0b21hdGlvbl9pZDogYXV0b21hdGlvbi5pZCxcclxuICAgICAgICBzdGF0dXM6IFwiZXJyb3JcIixcclxuICAgICAgICBwYXlsb2FkLFxyXG4gICAgICAgIGVycm9yX3RleHQ6IFN0cmluZyhlPy5tZXNzYWdlID8/IGUpLFxyXG4gICAgICB9KTtcclxuICB9XHJcbn1cclxuXHJcblxyXG4iXSwibmFtZXMiOlsiZ2V0U3VwYWJhc2VTZXJ2ZXJDbGllbnQiLCJkaXNwYXRjaEF1dG9tYXRpb25Gb3JFdmVudCIsInBheWxvYWQiLCJzdXBhYmFzZSIsImRhdGEiLCJhdXRvcyIsImZyb20iLCJzZWxlY3QiLCJlcSIsImJvYXJkX2lkIiwiY2FuZGlkYXRlcyIsImZpbHRlciIsImEiLCJtYXRjaEV2ZW50IiwidHJpZ2dlcl9jb25maWciLCJleGVjdXRlZCIsInJ1bkFjdGlvbnMiLCJpbnNlcnQiLCJhdXRvbWF0aW9uX2lkIiwiaWQiLCJzdGF0dXMiLCJlIiwiZXJyb3JfdGV4dCIsIlN0cmluZyIsIm1lc3NhZ2UiLCJjb25maWciLCJldmVudCIsInR5cGUiLCJ0b19saXN0X2lkIiwiZnJvbV9saXN0X2lkIiwiaW5fbGlzdF9pZCIsImxpc3RfaWQiLCJhY3Rpb24iLCJhY3Rpb25zIiwibGFiZWxJZCIsImxhYmVsX2lkIiwiY2FyZF9pZCIsInRocm93T25FcnJvciIsImxpc3RJZCIsImxhc3QiLCJvcmRlciIsImFzY2VuZGluZyIsImxpbWl0IiwibmV3UG9zIiwibGVuZ3RoIiwicG9zaXRpb24iLCJ1cGRhdGUiLCJkYXlzIiwiTnVtYmVyIiwiZHVlIiwiRGF0ZSIsIm5vdyIsInRvSVNPU3RyaW5nIiwiZHVlX2RhdGUiLCJjIiwic2luZ2xlIiwic2V0RGF0ZSIsImdldERhdGUiLCJpc28iLCJ2YWx1ZSIsInN0YXJ0X2RhdGUiLCJ1c2VySWQiLCJ1c2VyX2lkIiwiZGVsZXRlIiwibWF0Y2giLCJ0aXRsZSIsImNsIiwiaXRlbXMiLCJBcnJheSIsImlzQXJyYXkiLCJwb3MiLCJpdCIsImNoZWNrbGlzdF9pZCIsImRvbmUiLCJjaGVja2xpc3RJZCIsIml0ZW1JZCIsIml0ZW1faWQiLCJmaXJzdCIsInRleHQiLCJ0cmltIiwiY29udGVudCIsImF1dGhvcl9pZCIsImFjdG9yX2lkIiwiYiIsIndvcmtzcGFjZV9pZCIsIndtIiwiZmFsbGJhY2tVc2VyIiwiYXJjaGl2ZWRfYXQiLCJ3aGVuIiwic3RhcnQiLCJiYXNlIiwiZ2V0VGltZSIsIk1hdGgiLCJtYXgiLCJleGVjdXRlQXV0b21hdGlvbiIsImF1dG9tYXRpb24iXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/automation/engine.ts\n");

/***/ }),

/***/ "(rsc)/./lib/supabase-server.ts":
/*!********************************!*\
  !*** ./lib/supabase-server.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   getSupabaseServerClient: () => (/* binding */ getSupabaseServerClient)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/esm/wrapper.mjs\");\n\nfunction getSupabaseServerClient() {\n    const url = \"https://frtikymsgmaaaklerwpd.supabase.co\";\n    const serviceRole = process.env.SUPABASE_SERVICE_ROLE;\n    return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(url, serviceRole);\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc3VwYWJhc2Utc2VydmVyLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQXFEO0FBRTlDLFNBQVNDO0lBQ2YsTUFBTUMsTUFBTUMsMENBQW9DO0lBQ2hELE1BQU1HLGNBQWNILFFBQVFDLEdBQUcsQ0FBQ0cscUJBQXFCO0lBQ3JELE9BQU9QLG1FQUFZQSxDQUFDRSxLQUFLSTtBQUMxQiIsInNvdXJjZXMiOlsid2VicGFjazovL2thbmJhbnByby8uL2xpYi9zdXBhYmFzZS1zZXJ2ZXIudHM/MDk0ZiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldFN1cGFiYXNlU2VydmVyQ2xpZW50KCkge1xyXG5cdGNvbnN0IHVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCE7XHJcblx0Y29uc3Qgc2VydmljZVJvbGUgPSBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEUhO1xyXG5cdHJldHVybiBjcmVhdGVDbGllbnQodXJsLCBzZXJ2aWNlUm9sZSk7XHJcbn1cclxuXHJcbiJdLCJuYW1lcyI6WyJjcmVhdGVDbGllbnQiLCJnZXRTdXBhYmFzZVNlcnZlckNsaWVudCIsInVybCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJzZXJ2aWNlUm9sZSIsIlNVUEFCQVNFX1NFUlZJQ0VfUk9MRSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/supabase-server.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/tslib","vendor-chunks/iceberg-js"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fcards%2Froute&page=%2Fapi%2Fcards%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fcards%2Froute.ts&appDir=C%3A%5Cprojetos%5Ctrato%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5Cprojetos%5Ctrato&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();